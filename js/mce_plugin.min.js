(function(d){var e=null;var f={};var c={submit:'Place the submit form shortcode where you would like to position the user identification entry fields (email, etc.) and "Submit Your Response" button.',default_token:"A default token will ensure that the engagement content is displayed regardless of the means by which the visitor arrives at this article.  If not present, only visitors arriving through a link shared via INgageHub (through email, social, etc.) will see the engagement content.  Visitors arriving by other means will see the article without engagement content.  If present, visitors arriving through an INgageHub link will still use the token specific to them.  The default token is only used if visitors arrive through other means.",next_page:"You may specify an optional next page to which visitors will be redirected upon submitting responses.  If this shortcode is omitted, visitors will receive a confirmation message of their submission but remain on the same page.  If it is present, they will still receive confirmation but will also be redirected to the page you specify.",campaign_shortcode:"The campaign shortcode does not appear first.  The campaign shortcode [ingagehub_campaign] must appear before any other INgageHub shortcodes [ingagehub_...].  INgageHub shortcodes appearing before the campaign shortcode will be ignored.  Please edit the content to ensure the campaign shortcode appears before any other INgageHub shortcodes."};var b={attachmentsDontBelongToCampaignTitle:"Mismatched Questions",attachmentsDontBelongToCampaign:"One or more questions referenced in shortcodes are for questions that could not be found in the connected campaign.",buttonAdd:"Add",buttonAddDefaultToken:"Add Default Token",buttonAddNextPageShortcode:"Add Next Page",buttonAddSubmissionShortcode:"Add Submission Form",buttonAttachments:"Manage Questions",buttonCampaigns:"Manage Campaigns",buttonCancel:"Cancel",buttonEditorToolbar:"INgageHub Connect",buttonInsertAttachment:"Insert Question",buttonOK:"OK",buttonOptions:"Change Options",buttonRemoveDefaultToken:"Remove Default Token",buttonSelect:"Select",campaignListEmpty:"No usable campaigns found.  Either no campaigns exist or none were found that have at least one question defined.",campaignListEmptyTitle:"No Campaigns Found",campaignListRequestFailed:"The request for a list of campaigns from your INgageHub site failed.  Please check your settings, INgageHub site, or try again in a moment.",campaignListRequestFailedTitle:"Could Not Load the Campaign List",campaignSelectDialogConfirmation:"The campaign has been selected.  As you continue to edit your content, you can use the INgageHub tool to insert specific campaign questions as desirable.",campaignSelectDialogIncludeDefaulTokenLabel:"Include Default Token?*IMAGE_HELP*",campaignSelectDialogLabel:"Your content is not connected to an INgageHub campaign.  Please select a campaign to which this content will be connected.",campaignSelectDialogNothingSelected:"You must select a campaign.",campaignSelectDialogTitle:"Select the Campaign",campaignUnknownTitle:"Unknown Campaign",campaignUnknown:"The campaign shortcode is present but is referencing a campaign that does not exist.",confirmAbandonChanges:"The content on this page has changed.  Are you sure you want to leave this page?",customizeDialogAttachmentInserted:"The INgageHub campaign question has been inserted.",customizeDialogAttachmentsAllInserted:"All questions have already been inserted.",customizeDialogAttachmentsLabel:"The following questions available to insert:",customizeDialogAttachmentsNothingSelected:"You must select an question.",customizeDialogCampaignNameLabel:"Connected Campaign: ",customizeDialogDefaultTokenNotPresent:"The campaign shortcode does not have a default token specified.*IMAGE_HELP*",customizeDialogDefaultTokenPresent:"A default token is specified in the campaign shortcode.*IMAGE_HELP*",customizeDialogDefaultTokenRemoved:"The default token has been removed from the campaign shortcode.",customizeDialogNextPageShortcodeNotPresent:"You have not yet added the shortcode for the next page.*IMAGE_HELP*",customizeDialogNextPageShortcodePresent:"The shortcode for the next page has already been added.*IMAGE_HELP*",customizeDialogSubmissionShortcodeNotPresent:"You have not yet added the shortcode for the submission form.*IMAGE_HELP*",customizeDialogSubmissionShortcodePresent:"The shortcode for the submission form has already been added.*IMAGE_HELP*",customizeDialogTitle:"Customize Engagement",defaultTokenRequestFailed:"The request for a default token from your INgageHub site failed.  Please check your settings, INgageHub site, or try again in a moment.",defaultTokenRequestFailedTitle:"Default Token Request Failed",nextPageShortcodeDialogDefaultText:"/",nextPageShortcodeDialogLabel:"Please provide the URL to which visitors will be redirected upon submitting responses.",nextPageShortcodeDialogTitle:"Add Next Page Shortcode",pleaseWaitDialogDefaultTokenRequestMessage:"Please wait a moment while we connect to your INgageHub site and request a default token...",pleaseWaitDialogLoadingCampaignsMessage:"Please wait a moment while we connect to your INgageHub site and retrieve the list of your campaigns...",pleaseWaitDialogTitle:"Connecting to INgageHub",submissionShortcodeDialogDefaultText:"Submit Your Responses",submissionShortcodeDialogLabel:"Please provide the text you would like on the submit button.",submissionShortcodeDialogTitle:"Add Submission Form Shortcode"};var a=function(n){var u=function(){return wp.shortcode.next("ingagehub_campaign",n.getContent())};var v=function(w){return n.windowManager.open({title:b.pleaseWaitDialogTitle,body:[{type:"label",text:w}],buttons:[]})};var q=function(w,x){if(!n.isDirty()||(n.isDirty()&&confirm(b.confirmAbandonChanges))){n.windowManager.close(x);n.startContent=n.save();location.href=w}};var i=function(A,z,y,x){var w=n.windowManager.open({title:A,body:[{type:"label",text:z}],buttons:[{text:y,onClick:function(){q(x,w)}},{text:b.buttonCancel,onClick:function(){n.windowManager.close(w)}}]})};var h=function(){var w=v(b.pleaseWaitDialogLoadingCampaignsMessage);var x=function(){n.windowManager.close(w);i(b.campaignListRequestFailedTitle,b.campaignListRequestFailed,b.buttonOptions,INgageHub.optionsUrl)};d.ajax(INgageHub.ajaxUrl,{data:{action:"com_ingagehub_clist"},success:function(y){if(y.status==="OK"){e=y.campaigns;n.windowManager.close(w);p()}else{x()}},error:x})};var g=function(){var w=v(b.pleaseWaitDialogDefaultTokenRequestMessage);var x=function(z){n.windowManager.close(w);i(b.defaultTokenRequestFailedTitle,b.defaultTokenRequestFailed,b.buttonOptions,INgageHub.optionsUrl)};var y=u();if(typeof(y)!=="undefined"){d.ajax(INgageHub.ajaxUrl,{data:{action:"com_ingagehub_ctoken",id:y.shortcode.attrs.named.id},success:function(z){if(z.status==="OK"){n.windowManager.close(w);y=u();if(typeof(y)!=="undefined"){y.shortcode.set("default_token",z.sharing_token);n.setContent(wp.shortcode.replace("ingagehub_campaign",n.getContent(),function(){return y.shortcode.string()}))}}else{x(z)}},error:x})}};var j=function(){var w=u();if(typeof(w)!=="undefined"){delete w.shortcode.attrs.named.default_token;n.setContent(wp.shortcode.replace("ingagehub_campaign",n.getContent(),function(){return w.shortcode.string()}))}};var t=function(){var w=d(".ih-connect-help");w.unbind("click");w.bind("click",function(y){y.preventDefault();var x=d(y.target).attr("data-help-id");n.windowManager.alert(c[x]);return false})};var k=function(w,x){w.innerHTML=w.innerHTML.replace("*IMAGE_HELP*",function(){return'&nbsp;<img class="ih-connect-help" data-help-id="'+x+'" src="'+INgageHub.pluginUrl+'images/help_16x16.png" />'})};var s=function(w){w.innerHTML=w.innerHTML.replace("*IMAGE_CHECK*",function(){return'&nbsp;<img valign="middle" src="'+INgageHub.pluginUrl+'images/check_32x32.png" />'}).replace("*IMAGE_ALERT*",function(){return'&nbsp;<img valign="middle" src="'+INgageHub.pluginUrl+'images/alert_32x32.png" />'}).replace("*IMAGE_INFO*",function(){return'&nbsp;<img valign="middle" src="'+INgageHub.pluginUrl+'images/info_32x32.png" />'})};var l=function(){var x=[];d.each(e,function(z,y){if(y.campaign_attachments.length>0){x.push({value:y.id,text:y.name})}});if(x.length===0){i(b.campaignListEmptyTitle,b.campaignListEmpty,b.buttonCampaigns,INgageHub.campaignsUrl);return}x.unshift({text:"",value:0});var w=n.windowManager.open({title:b.campaignSelectDialogTitle,onPostRender:t,body:[{type:"label",text:b.campaignSelectDialogLabel},{name:"selcamp",type:"listbox",values:x,value:0},{name:"deftok",type:"checkbox",text:b.campaignSelectDialogIncludeDefaulTokenLabel,onPostRender:function(){k(this.getEl(),"default_token")}}],buttons:[{text:b.buttonSelect,onclick:function(){var z=w.find("#selcamp")[0];if(z.value()===0){n.windowManager.alert(b.campaignSelectDialogNothingSelected);return}n.selection.setContent("[ingagehub_campaign id="+z.value()+"]"+z.text()+"[/ingagehub_campaign]");var y=(w.find("#deftok").length>0&&w.find("#deftok")[0].value());n.windowManager.close(w);if(y){g()}n.windowManager.alert(b.campaignSelectDialogConfirmation)}},{text:b.buttonCancel,onclick:function(){n.windowManager.close(w)}},{text:b.buttonCampaigns,onclick:function(){q(INgageHub.campaignsUrl,w)}}]})};var o=function(z){if(n.getContent().indexOf("[ingagehub_")<n.getContent().indexOf("[ingagehub_campaign")){n.windowManager.alert(c.campaign_shortcode);return}var E=parseInt(z.shortcode.attrs.named.id);d.each(e,function(H,G){if(parseInt(G.id)===E){f=G}});if(typeof(f.id)==="undefined"){i(b.campaignUnknownTitle,b.campaignUnknown,b.buttonCampaigns,INgageHub.campaignsUrl);return}var F=[];d.each(f.campaign_attachments,function(H,G){F.push({text:G.question,value:G.id})});var A=n.getContent();var x=wp.shortcode.next("ingagehub_attachment",A);while(typeof(x)!=="undefined"){var w=d.grep(f.campaign_attachments,function(H,G){return(H.id===parseInt(x.shortcode.attrs.named.id))});if(0===w.length){i(b.attachmentsDontBelongToCampaignTitle,b.attachmentsDontBelongToCampaign,b.buttonCampaigns,INgageHub.campaignsUrl+"&action=edit_campaign&campaign_id="+E);return}F=d.grep(F,function(H,G){return(H.value!==parseInt(x.shortcode.attrs.named.id))});A=A.substr(x.index+x.content.length);x=wp.shortcode.next("ingagehub_attachment",A)}var C=f.name;if(C.length>60){C=C.substr(0,57)+"..."}var B=[{type:"label",text:""},{type:"label",text:b.customizeDialogCampaignNameLabel+": "+C,style:"font-weight: bold;"},{type:"label",text:""}];var D=[{text:b.buttonCancel,onclick:function(){n.windowManager.close(y)}}];if(0===F.length){B.push({type:"label",text:"*IMAGE_CHECK*",minWidth:38,minHeight:36,onPostRender:function(){s(this.getEl())}},{type:"label",text:b.customizeDialogAttachmentsAllInserted,style:"padding-top: 8px;"},{type:"button",text:b.buttonAttachments,onClick:function(){q(INgageHub.campaignsUrl+"&action=edit_campaign&campaign_id="+E,y)}})}else{F.unshift({text:"",value:0});B.push({type:"label",text:"*IMAGE_ALERT*",minWidth:38,minHeight:36,onPostRender:function(){s(this.getEl())}},{type:"container",layout:"stack",items:[{type:"label",text:b.customizeDialogAttachmentsLabel,style:"margin-bottom: 5px;"},{type:"listbox",name:"selatt",style:"overflow-x: hidden",values:F,value:0}]},{type:"container",layout:"stack",items:[{type:"button",text:b.buttonInsertAttachment,style:"text-align: center; margin-bottom: 5px;",onclick:function(){var G=y.find("#selatt")[0];if(G.value()===0){n.windowManager.alert(b.customizeDialogAttachmentsNothingSelected);return}n.selection.setContent("[ingagehub_attachment id="+G.value()+"]"+G.text()+"[/ingagehub_attachment]");n.windowManager.close(y);n.windowManager.alert(b.customizeDialogAttachmentInserted)}},{type:"button",text:b.buttonAttachments,style:"text-align: center;",onClick:function(){q(INgageHub.campaignsUrl+"&action=edit_campaign&campaign_id="+E,y)}}]})}if(wp.shortcode.next("ingagehub_submit",n.getContent())){B.push({type:"label",text:"*IMAGE_CHECK*",minWidth:38,minHeight:36,onPostRender:function(){s(this.getEl())}},{type:"label",text:b.customizeDialogSubmissionShortcodePresent,style:"padding-top: 8px;",onPostRender:function(){k(this.getEl(),"submit")}},{type:"label",text:""})}else{B.push({type:"label",text:"*IMAGE_ALERT*",minWidth:38,minHeight:36,onPostRender:function(){s(this.getEl())}},{type:"label",text:b.customizeDialogSubmissionShortcodeNotPresent,style:"padding-top: 8px;",onPostRender:function(){k(this.getEl(),"submit")}},{type:"button",text:b.buttonAddSubmissionShortcode,onclick:function(){n.windowManager.close(y);m()}})}if(wp.shortcode.next("ingagehub_next_page",n.getContent())){B.push({type:"label",text:"*IMAGE_CHECK*",minWidth:38,minHeight:36,onPostRender:function(){s(this.getEl())}},{type:"label",text:b.customizeDialogNextPageShortcodePresent,style:"padding-top: 8px;",onPostRender:function(){k(this.getEl(),"next_page")}},{type:"label",text:""})}else{B.push({type:"label",text:"*IMAGE_INFO*",minWidth:38,minHeight:36,onPostRender:function(){s(this.getEl())}},{type:"label",text:b.customizeDialogNextPageShortcodeNotPresent,style:"padding-top: 8px;",onPostRender:function(){k(this.getEl(),"next_page")}},{type:"button",text:b.buttonAddNextPageShortcode,onclick:function(){n.windowManager.close(y);r()}})}if(typeof(z.shortcode.attrs.named.default_token)==="undefined"||z.shortcode.attrs.named.default_token.length!==19){B.push({type:"label",text:"*IMAGE_INFO*",minWidth:38,minHeight:36,onPostRender:function(){s(this.getEl())}},{type:"label",text:b.customizeDialogDefaultTokenNotPresent,style:"padding-top: 8px;",onPostRender:function(){k(this.getEl(),"default_token")}},{type:"button",text:b.buttonAddDefaultToken,onclick:function(){n.windowManager.close(y);g()}})}else{B.push({type:"label",text:"*IMAGE_CHECK*",minWidth:38,minHeight:36,onPostRender:function(){s(this.getEl())}},{type:"label",text:b.customizeDialogDefaultTokenPresent,style:"padding-top: 8px;",onPostRender:function(){k(this.getEl(),"default_token")}},{type:"button",text:b.buttonRemoveDefaultToken,onclick:function(){n.windowManager.close(y);j();n.windowManager.alert(b.customizeDialogDefaultTokenRemoved)}})}var y=n.windowManager.open({title:b.customizeDialogTitle,onPostRender:t,body:[{type:"container",layout:"grid",columns:3,spacing:10,alignH:"stretch",items:B}],buttons:D})};var m=function(){var w=n.windowManager.open({title:b.submissionShortcodeDialogTitle,body:[{type:"label",text:b.submissionShortcodeDialogLabel},{type:"textbox",name:"btntext",value:b.submissionShortcodeDialogDefaultText}],buttons:[{text:b.buttonAdd,onclick:function(){var x=w.find("#btntext")[0].value();x=x.replace(/"/g,"'");if(x.length===0||x===b.submissionShortcodeDialogDefaultText){n.selection.setContent("[ingagehub_submit]")}else{n.selection.setContent('[ingagehub_submit button_text="'+x+'"]')}n.windowManager.close(w)}},{text:b.buttonCancel,onclick:function(){n.windowManager.close(w)}}]})};var r=function(){var w=n.windowManager.open({title:b.nextPageShortcodeDialogTitle,body:[{type:"label",text:b.nextPageShortcodeDialogLabel},{type:"textbox",name:"nextpage",value:b.nextPageShortcodeDialogDefaultText}],buttons:[{text:b.buttonAdd,onclick:function(){var x=w.find("#nextpage")[0].value();n.selection.setContent("[ingagehub_next_page]"+x+"[/ingagehub_next_page]");n.windowManager.close(w)}},{text:b.buttonCancel,onclick:function(){n.windowManager.close(w)}}]})};var p=function(){if(e===null){h()}else{f={};var w=u();if(w){o(w)}else{l()}}};p()};tinymce.create("tinymce.plugins.INgageHub",{init:function(g,h){g.addButton("button_ih_connect",{title:b.buttonEditorToolbar,image:INgageHub.pluginUrl+"images/ih_button_20x20.png",onclick:function(){a(g)}})},createControl:function(h,g){return null}});tinymce.PluginManager.add("com_ingagehub_mce_plugin",tinymce.plugins.INgageHub)})(jQuery);